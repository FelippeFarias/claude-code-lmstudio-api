# 実装計画

- [x] 1. プロジェクト構造とコア設定の作成
  - Node.jsプロジェクトの初期化とpackage.json作成
  - TypeScript設定とBiome.js設定
  - .envファイルとDocker関連ファイルの作成
  - _要件: 2.3, 2.4_

- [x] 2. 基本的なExpress.jsサーバーの実装
  - Express.jsアプリケーションの基本構造を作成
  - 環境変数読み込みとサーバー設定の実装
  - CORS設定とミドルウェアの設定
  - _要件: 2.1, 2.2_

- [x] 3. データモデルとインターフェースの定義
  - OpenAI API互換のTypeScriptインターフェースを定義
  - Claude Code SDK用のインターフェースを定義
  - エラーレスポンス形式とヘルスチェック形式を定義
  - _要件: 1.1, 1.2_

- [x] 4. Claude Code SDKクライアントの実装
  - Claude Code SDKの初期化とセッション管理
  - チャット機能とテキスト補完機能の実装
  - モデル名変換機能（claude-code-auto/opus/sonnet → SDK形式）
  - _要件: 1.1, 1.3, 1.4, 4.1_

- [x] 5. リクエスト変換器の実装
  - OpenAI chat/completionsリクエストをClaude Code形式に変換
  - OpenAI completionsリクエストをClaude Code形式に変換
  - パラメータマッピングとバリデーション機能
  - _要件: 1.1, 1.3_

- [x] 6. レスポンス変換器の実装
  - Claude CodeレスポンスをOpenAI chat/completions形式に変換
  - Claude CodeレスポンスをOpenAI completions形式に変換
  - 固定モデル一覧（claude-code-auto/opus/sonnet）の生成とエラーレスポンス生成
  - _要件: 1.2, 1.4_

- [x] 7. APIエンドポイントの実装
- [x] 7.1 GET /v1/modelsエンドポイントの実装
  - モデル一覧取得のルートハンドラー作成
  - 固定モデル一覧（claude-code-auto, claude-code-opus, claude-code-sonnet）をOpenAI形式で返す
  - エラーハンドリングとログ出力の実装
  - _要件: 1.4_

- [x] 7.2 POST /v1/chat/completionsエンドポイントの実装
  - チャット補完のルートハンドラー作成
  - リクエスト変換、Claude Code SDK呼び出し、レスポンス変換の統合
  - ストリーミング対応とエラーハンドリング
  - _要件: 1.1, 1.2, 1.3_

- [x] 7.3 POST /v1/completionsエンドポイントの実装
  - テキスト補完のルートハンドラー作成
  - リクエスト変換、Claude Code SDK呼び出し、レスポンス変換の統合
  - ストリーミング対応とエラーハンドリング
  - _要件: 1.1, 1.2, 1.3_

- [x] 7.4 POST /v1/embeddingsエンドポイントの実装
  - 未対応機能として501エラーを返すハンドラー作成
  - 適切なエラーメッセージとOpenAI互換のエラー形式
  - _要件: 1.1, 1.2_

- [x] 8. ヘルスチェックとメトリクスエンドポイントの実装
  - GET /healthエンドポイントでClaude Code SDKの状態確認
  - GET /metricsエンドポイントで基本的な統計情報を提供
  - サービス状態の監視とログ出力
  - _要件: 2.4, 6.3, 6.4_

- [x] 9. エラーハンドリングとログ機能の実装
  - 統一されたエラーハンドリングミドルウェア
  - 構造化ログ（JSON形式）の実装
  - リクエスト/レスポンスのログ記録とエラートレーシング
  - _要件: 6.1, 6.2_

- [x] 10. Docker化の実装
- [x] 10.1 Dockerfileの作成
  - Node.js 22-alpineベースのDockerfile作成
  - UID/GIDマッピング用のユーザー作成
  - Claude Code設定ディレクトリの準備
  - _要件: 2.1, 2.3, 3.1, 3.2_

- [x] 10.2 Docker Compose設定の作成
  - compose.yamlファイルの作成
  - ボリュームマウントとポート設定
  - セキュリティ設定と環境変数の設定
  - _要件: 2.1, 2.2, 2.3, 3.1, 3.2, 3.3, 3.4_

- [ ] 11. 単体テストの実装
- [ ] 11.1 リクエスト/レスポンス変換器のテスト
  - OpenAI形式とClaude Code形式間の変換テスト
  - パラメータマッピングとバリデーションのテスト
  - エラーケースのテスト
  - _要件: 1.1, 1.2_

- [ ] 11.2 Claude Code SDKクライアントのテスト
  - SDK初期化とセッション管理のテスト
  - チャット機能とテキスト補完機能のテスト
  - モデル名変換機能のテスト
  - _要件: 1.3, 1.4, 4.1_

- [ ] 11.3 APIエンドポイントのテスト
  - 各エンドポイントの正常系・異常系テスト
  - embeddings未対応エラーのテスト
  - ヘルスチェックとメトリクスのテスト
  - _要件: 1.1, 1.2, 1.3, 1.4, 6.3, 6.4_

- [ ] 12. 統合テストの実装
  - OpenAI APIクライアントからの完全なフローテスト
  - ストリーミングレスポンス処理のテスト
  - エラーハンドリングとログ出力のテスト
  - _要件: 1.1, 1.2, 1.3, 1.4, 6.1, 6.2_

- [ ] 13. セキュリティテストの実装
  - ファイルシステム隔離のテスト
  - UID/GID権限マッピングのテスト
  - Claude Code設定ディレクトリアクセス権限のテスト
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 14. ドキュメントとREADMEの作成
  - プロジェクトのREADME.mdファイル作成
  - Docker Composeでの起動手順とAPI使用例
  - 環境変数設定とトラブルシューティングガイド
  - _要件: 2.1, 2.2, 2.3_