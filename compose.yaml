services:
  claude-code-lmstudio-api:
    build:
      context: .
      args:
        UID: ${UID:-1000}
        GID: ${GID:-1000}
    container_name: claude-code-lmstudio-api
    ports:
      - "1235:1235"
    env_file:
      - .env
    environment:
      - NODE_ENV=production
      - PORT=1235
    volumes:
      - ./home:/home/appuser
      - ~/.claude:/home/appuser/.claude
    user: "${UID:-1000}:${GID:-1000}"
    security_opt:
      - no-new-privileges:true
    tmpfs:
      - /tmp
      - /app/.npm
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:1235/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    develop:
      watch:
        - action: sync+restart
          path: .env
          target: /dev/null
        - action: rebuild
          path: src
        - action: rebuild
          path: package-lock.json

volumes:
  workspace:
    driver: local